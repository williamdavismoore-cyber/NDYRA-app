<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Admin Status — NDYRA</title>
  <link rel="icon" href="/assets/branding/favicon-32.png">
  <link rel="apple-touch-icon" href="/assets/branding/apple-touch-icon-180.png">
  <meta name="theme-color" content="#000000">
  <link rel="manifest" href="/manifest.webmanifest">
  <link rel="stylesheet" href="/assets/css/styles.css?v=2026-02-26_53">
</head>
<body data-page="admin-status">
  <div class="header">
  <div class="header-inner">
    <a class="logo" href="/">
      <img src="/assets/branding/NDYRA_Wordmark.png" alt="NDYRA">
    </a>
    <div class="nav">
      <a href="/workouts/" title="Public workout previews">Workouts</a>
      <a href="/pricing.html">Pricing</a>
      <a href="/for-gyms/">For Gyms</a>
      <a href="/auth/login.html" class="primary">Log in</a>
      <a href="/biz/" title="Staff/Admin only">Business</a>
      <span class="badge" data-role-pill>Guest</span>
      <span class="badge" data-tenant-pill style="display:none"></span>
    </div>
  </div>
</div>

  <div class="container">
    <div class="section-title">
      <h2>System Status</h2>
      <div class="small">Master Admin — deployment + integrations checklist</div>
    </div>

    <div class="banner">
      <strong>Important</strong>
      Stripe requires a Netlify deploy with Functions enabled. Netlify Drop is fine for UI previews, but it will not reliably run server-side endpoints.
    </div>

    <div class="grid" style="grid-template-columns:repeat(auto-fit,minmax(280px,1fr)); margin-top:14px">
      <div class="card" style="min-height:auto">
        <div class="meta">
          <div class="title">Functions health</div>
          <p class="small">Pings <span class="mono">/api/health</span> to confirm Functions are running.</p>
          <div class="btn-row" style="margin-top:10px">
            <button class="btn primary" data-health-refresh>Refresh</button>
            <a class="btn" href="/admin/">Back</a>
          </div>
          <pre class="mono" data-health-output style="white-space:pre-wrap; margin-top:10px; background:rgba(255,255,255,.04); padding:12px; border-radius:12px; border:1px solid rgba(255,255,255,.10)">Loading…</pre>
        </div>
      </div>

      <div class="card" style="min-height:auto">
        <div class="meta">
          <div class="title">Stripe public config</div>
          <p class="small">Loaded from <span class="mono">/assets/data/stripe_public_test.json</span> (safe fields only).</p>
          <pre class="mono" data-stripe-output style="white-space:pre-wrap; margin-top:10px; background:rgba(255,255,255,.04); padding:12px; border-radius:12px; border:1px solid rgba(255,255,255,.10)">Loading…</pre>
        </div>
      </div>

      <div class="card" style="min-height:auto">
        <div class="meta">
          <div class="title">Netlify env vars checklist</div>
          <p class="small">Set these in Netlify → Site configuration → Environment variables.</p>
          <div class="small" style="line-height:1.6">
            <div><span class="mono">STRIPE_SECRET_KEY</span> (required)</div>
            <div><span class="mono">STRIPE_WEBHOOK_SIGNING_SECRET</span> (required)</div>
            <div style="margin-top:10px"><strong>Optional (price overrides)</strong></div>
            <div><span class="mono">PRICE_ID_MEMBER_MONTHLY</span></div>
            <div><span class="mono">PRICE_ID_MEMBER_ANNUAL</span></div>
            <div><span class="mono">PRICE_ID_BIZ_PRO_MONTHLY</span> (or legacy <span class="mono">PRICE_ID_BIZ_MONTHLY</span>)</div>
            <div><span class="mono">PRICE_ID_BIZ_PRO_ANNUAL</span> (or legacy <span class="mono">PRICE_ID_BIZ_ANNUAL</span>)</div>
            <div><span class="mono">PRICE_ID_BIZ_STARTER_MONTHLY</span> (needed to enable Starter checkout)</div>
            <div><span class="mono">PRICE_ID_BIZ_STARTER_ANNUAL</span> (needed to enable Starter checkout)</div>
            <div><span class="mono">STRIPE_PORTAL_CONFIGURATION_ID</span> (optional)</div>
            <div class="small" style="margin-top:10px">Supabase vars will be added once we wire auth + entitlements.</div>
          </div>
          </div>
        </div>
      </div>
    </div>

    <div class="section-title" style="margin-top:18px">
      <h2>Recommended deploy method</h2>
    </div>

    <div class="card" style="min-height:auto">
      <div class="meta">
        <div class="title">Netlify (paid) — Git deploy</div>
        <p class="small" style="max-width:900px">
          Best practice for this project: connect a Git repo to Netlify so Functions deploy every time.
          Publish directory should be <span class="mono">site</span> and Functions directory should be <span class="mono">netlify/functions</span>.
        </p>
        <div class="pill">Recommended</div>
      </div>
    </div>
  </div>

    <div class="section-title" style="margin-top:18px">
      <h2>QA Tools (when things look stale)</h2>
    </div>

    <div class="grid" style="grid-template-columns:repeat(auto-fit,minmax(280px,1fr)); margin-top:14px">
      <div class="card" style="min-height:auto">
        <div class="meta">
          <div class="title">Hard refresh helper</div>
          <p class="small">If you're seeing an old build (or the wrong brand), this clears Service Worker + Cache Storage and reloads.</p>
          <div class="btn-row" style="margin-top:10px">
            <button class="btn primary" data-qa-clear-sw>Clear SW + cache + reload</button>
            <button class="btn" data-qa-reset-demo>Reset demo login</button>
          </div>
          <pre class="mono" data-qa-output style="white-space:pre-wrap; margin-top:10px; background:rgba(255,255,255,.04); padding:12px; border-radius:12px; border:1px solid rgba(255,255,255,.10)">Ready.</pre>
        </div>
      </div>

      <div class="card" style="min-height:auto">
        <div class="meta">
          <div class="title">Quick links</div>
          <p class="small">Jump straight into the NDYRA Social Shell for QA.</p>
          <div class="btn-row" style="margin-top:10px">
            <a class="btn primary" href="/app/">Open /app (For You)</a>
            <a class="btn" href="/app/following/">Following</a>
            <a class="btn" href="/gym/demo/join">Quick Join demo</a>
          </div>
        </div>
      </div>
    </div>

  <div class="footer">
  <div class="container">
    <div>NDYRA — build preview (<span data-build-label>CP??</span>). Status console added.</div>
  </div>
</div>

  <script>
    if('serviceWorker' in navigator){
      window.addEventListener('load', ()=> navigator.serviceWorker.register('/sw.js').catch(()=>null));
    }
  </script>
  <script src="/assets/js/site.js?v=2026-02-26_53" defer></script>

  <script>
    async function qaClearSwAndCaches(){
      const out = document.querySelector('[data-qa-output]');
      if (out) out.textContent = 'Clearing Service Worker + caches...';

      try {
        if ('serviceWorker' in navigator) {
          const regs = await navigator.serviceWorker.getRegistrations();
          await Promise.all(regs.map(r => r.unregister()));
        }

        if ('caches' in window) {
          const keys = await caches.keys();
          await Promise.all(keys.map(k => caches.delete(k)));
        }

        // Clear NDYRA + legacy demo keys (keeps you from getting stuck)
        const prefixes = ['ndyra_', 'hiit56_'];
        for (const k of Object.keys(localStorage)) {
          if (prefixes.some(p => k.startsWith(p))) localStorage.removeItem(k);
        }

        if (out) out.textContent = 'Cleared. Reloading...';
        location.reload();
      } catch (e) {
        if (out) out.textContent = 'ERROR: ' + (e && e.message ? e.message : String(e));
      }
    }

    function qaResetDemo(){
      const out = document.querySelector('[data-qa-output]');
      try {
        [
          'ndyra_demo_role','ndyra_demo_tenant','ndyra_demo_tenant_name','ndyra_demo_email','ndyra_demo_guest',
          'hiit56_role','hiit56_tenant','hiit56_tenant_name','hiit56_email'
        ].forEach(k => localStorage.removeItem(k));

        if (out) out.textContent = 'Demo state cleared. Go to /login.html to pick a role again.';
      } catch (e) {
        if (out) out.textContent = 'ERROR: ' + (e && e.message ? e.message : String(e));
      }
    }

    document.addEventListener('DOMContentLoaded', () => {
      const b1 = document.querySelector('[data-qa-clear-sw]');
      const b2 = document.querySelector('[data-qa-reset-demo]');
      if (b1) b1.addEventListener('click', qaClearSwAndCaches);
      if (b2) b2.addEventListener('click', qaResetDemo);
    });
  </script>

</body>
</html>
